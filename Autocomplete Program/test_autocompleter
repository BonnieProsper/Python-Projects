import pytest
from intelligent_autocompleter import Trie, BKTree, ContextPredictor, Autocompleter


def test_trie_insert_and_search():
    t = Trie()
    t.insert("hello")
    t.insert("help")
    res = t.search_prefix("he")
    assert len(res) == 2
    assert res[0][0].startswith("he")


def test_bktree_fuzzy_match():
    b = BKTree()
    for w in ["hello", "help", "halo"]:
        b.insert(w)
    matches = b.query("helo", max_dist=1)
    assert any(m[0] == "hello" for m in matches)


def test_context_predictor():
    c = ContextPredictor()
    c.learn("thank you very much")
    preds = c.predict("thank")
    assert preds[0][0] == "you"


def test_autocompleter_learn_and_suggest(tmp_path):
    data = tmp_path / "data.json"
    ac = Autocompleter(data_path=str(data))
    ac.learn_from_input("thank you for coming")
    suggestions = ac.suggest("thank yuo")
    assert "you" in suggestions
